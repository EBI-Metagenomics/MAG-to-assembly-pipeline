nextflow_process {

    name "Test Process DOWNLOAD_INPUT"
    script "../main.nf"
    process "DOWNLOAD_INPUT"

    test("Download MAG/bin accessions from ENA/MGnify and prepare the input") {

        when {
            process {
                """
                input[0] = file("${projectDir}/data/tests/processed_accessions.tsv")
                input[1] = "input_accessions.tsv"
                input[2] = file("${projectDir}/data/known_and_found_gut_genomes.tsv")
                input[3] = "all_catalog_metadata.tsv"
                """
            }
        }

        then {
            assert process.success
            // check header of metadata table
            assert path(process.out.metadata.get(0)).readLines().contains('Genome	Genome_type	Genome_accession	Species_rep')
            // check the first line of metadata table
            assert path(process.out.metadata.get(0)).readLines().contains('MGYG000307600	MAG	GCA_018713305	MGYG000307600')
            // check the first line of input list of accessions
            assert path(process.out.input_accessions.get(0)).readLines().contains('GCA_018713305')

        }

    }

}
